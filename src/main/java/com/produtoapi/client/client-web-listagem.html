<!DOCTYPE html>
<html lang="pt-BR"> <!--Define o tipo de documento como HTML% e a linguagem da pag como português do Brasil-->
<head>
    <meta charset="UTF-8"> <!-- Conjunto de caracteres da pag-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Configuração para dispositivos moveis-->
    <title>Lista de Produtos</title> <!--Titulo da pag-->
</head>
<body>
    <h2>Lista de Produtos - HTML/JavaScript</h2><!--Titulo principal da pag-->
    <!--Tabela que exibira a lista de produtos-->
    <table id="produtosTable" border="1">
        <thead>
            <tr>    
                <th>ID</th><!--Cabeçalho da coluna id-->
                <th>NOME</th><!--Cabeçalho da coluna Nome-->
                <th>PREÇO</th><!--Cabeçalho da coluna Preço-->
                <th>QUANTIDADE</th><!--Cabeçalho da coluna Quantidade-->
                <th>DISPONIBILIDADE</th><!--Cabeçalho da coluna Disponibilidade-->
            </tr>
        </thead>
        <tbody>
            <!--Linhas da tabela serão inseridas aqui-->
        </tbody>
    </table>
    <!--Mensagem de erro-->
        <div id="erroMensagem" style="color: red; display:none;"><!--Div para exibir mensagem de erro-->
            Erro ao buscar, tente mais tarde!
        </div>
        <!--Total de produtos-->
        <div id="totalProdutos">Total de Produtos: 0</div><!--Div para exibir o total de produtos-->
        <!--Função JavaScript(similar aos métodos Java)-->
        <script>
            //Função para listar os produtos
            function listarProdutos() {
                //Faz uma requisição GET para o endPoint de produtos
                fetch('http://localhost:8080/produtos') //Url do endpoint
                    .then(response => {//O metodo .then é usado para encadear ações
                            if(!response.ok){
                                //Lança um erro se a reposta não for ok
                                //Quando um erro é lançado, o fluxo de execução do codigo é interrompido e ele salta para o bloco catch
                                throw new Error('Erro na rede: ' + response.status);
                            }  
                            //Converte a repsota para JSON
                            return response.json();//Converte a resposta para JSON  
                    })
                    .then(data => {
                        //Obtém o corpo da tabela
                        const tableBody  = document.getElementById('produtosTable').getElementsByTagName('tbody')[0];
                        let totalProdutos = 0; //Inicializa o contador de produtos
                        //Itera sobre os dados recebidos e cria as linhas da tabela
                        data.forEach(produto => {
                            const row = tableBody.insertRow();
                            const cellId = row.insertCell(0);
                            const cellNome = row.insertCell(1);
                            const cellPreco = row.insertCell(2);
                            const cellQuantidade = row.insertCell(3);
                            const cellStatus = row.insertCell(4);
                            // Insere os dados nas células
                            cellId.textContent = produto.id;//Insere o id na celula
                            cellNome.textContent = produto.nome;//Insere o nome na celula
                            cellPreco.textContent = produto.preco;//Insere o preço na celula
                            cellQuantidade.textContent = produto.quantidade;//Insere a quantidade na celula
                            cellStatus.textContent = produto.status;//Insere o status na celula
                            totalProdutos++;//Incrementa o contador de produtos
                        });
                        document.getElementById('totalProdutos').textContent = 'Total de Produtos: ' + totalProdutos; 
                    })
                    .catch (error => {
                        console.error('Erro ao buscar produtos: ', error); //Exibe o erro no console
                        //Exibe a mensagem de erro
                        document.getElementById('erroMensagem').style.display = 'block'; //Exibe a mensagem de erro
                    });
            }
            //Executa a função listarProdutos quando a pag é carrega
            document.addEventListener('DOMContentLoaded', listarProdutos);
        </script>
    </body>
</html>